
## パッケージマネージャー
さまざまなソフトウェアやライブラリを**１つのパッケージとして扱い**、  
インストールやアップデートを行うことができるツール。  

インストールしたソフトウェアの**バージョン情報を管理し**、  
ソフトウェア同士の依存性を管理できる。  

Windows なら「**Chocolatey**」、  
macOS なら「**Homebrew**」、  
Node.js なら「**npm**」、などがある。  

<br>

Webサイトの制作では、**プロジェクトのディレクトリごとに使用している Node.js のバージョン**が異なる場合がある。  
そこで、バージョン別にインストール可能で、切り替えのできるCUIのツールがよく利用されている。  

macOS ではディレクトリごとに切り替えが容易な「**nodenv**」を使う。  

<br>
<br>

## nodenv をインストールする
macOs に nodenv をインストールするには、パッケージマネージャーの「**Homebrew**」を使用する。  

```rb
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

<br>

Homebrew では「**brew**」コマンドでバージョン情報を表示できる。  
```rb
$ brew -v
```
バージョン情報が表示されれば、インストール完了の証。  

<br>

続いて、`brew` コマンドを使って、**nodenv** をインストールする。  

```rb
$ brew install nodenv
```
nodenv の初期設定をシェルの設定ファイルへ追記するために、  
**echo** コマンドを使って記述を追加する。  
```yml
// シェルが zsh の場合
$ echo 'eval "$(nodenv init -)"' >> ~/.zshrc

// シェルが bash の場合
$echo 'eval "$(nodenv init -)"' >> ~/.bashrc
```

<br>

記述を追加したら設定ファイルを再読み込みするために、`source` コマンドを実行する。  
```yml
// シェルが zsh の場合
$ source ~/.zshrc

// シェルが bash の場合
$ source ~/.bashrc
```
nodenv が正しく設定されていることを確認するために、**nodenv-doctor** スクリプトを使用する。
```rb
$ curl -fsSL https://github.com/nodenv/nodenv-installer/raw/master/bin/nodenv-doctor | bash
```

<br>

実際に nodenv コマンドでバージョン情報を表示してみる。  
```rb
$ nodenv -v
```

<br>
<br>

## Node.js をインストールする
nodenv を使ってインストールできる Node.js のバージョンを確認する。  
```rb
$ nodenv install -l
```
コマンドは「**nodenv install バージョン番号**」でインストールできる。  

<br>

指定したバージョンがインストールできたら、**システム上で使用するバージョン**を指定する。  
```rb
$ nodenv global 16.13.1
```
また、nodenv を使ってインストールしたバージョンの一覧も確認できる。  
```rb
$ nodenv versions
```
> 「*」のついているバージョン番号が、現在使用しているバージョン。  

<br>
<br>

## Node.jsのバージョンを切り替える
使用するバージョンを切り替えるときは、  
切り替えたいバージョンをインストールした後「**nodenv global**」を使用する。  

また、特定のディレクトリのみ指定したバージョンを使用する場合は、  
該当ディレクトリに移動し、「**nodenv local**」を使用する。  
```4D
// 別のバージョンをインストールする
$ nodenv install 16.13.1

// システム全体で使えるように設定する
$ nodenv global 16.13.1
```
```4D
// 別のバージョンをインストールする
$ nodenv install 16.13.1

// 特定のディレクトリへ移動
$ cd mdn

// 特定のディレクトリのみ、16.13.1 を有効化する
$ nodenv local 16.13.1
```

<br>
<br>

## パッケージマネージャー「npm」
Node.js で動作するように作られたものには、  
**Sass** や **Gulp** など、数多くのツールやライブラリが存在する。  

それらのインストールやアップデート、バージョン情報などを含めて管理する  
パッケージマネージャーのことを **npm（Node Package Maneger）** という。  

npm は **Node.js** と一緒にインストールされ、インストール後は npm コマンドが利用できるようになる。  
```rb
$ npm --version
```

<br>
<br>

## npmコマンドを使ったインストール方法
インストール方法には、「**グローバルインストール**」と「**ローカルインストール**」の２つがある。  

グローバルインストールは**システム全体で使う場合に使用し**、  
パッケージはシステム側のディレクトリに格納される。  

ローカルインストールは**コマンドを実行したディレクトリ内**に「**node_modules**」ディレクトリが作成され、  
そこにパッケージが格納され、そのディレクトリ内でのみ使用できるようになる。  
```4D
// ローカルインストール
$ npm install sass

// グローバルインストール
$ npm install -g sass
```

<br>

インストールされたパッケージは、**パッケージ名でのコマンド利用**か、  
**ローカルインストールであれば**「**npx**」コマンドを使って実行可能。  

>  【 **memo** 】  
> npx コマンドは、npm のバージョン5.2以降で使えるコマンド  
> 従来までは、ローカルインストールされたライブラリのコマンドを実行する場合、  
> **Gulp** であれば `node_modules/gulp/bin/gulp.js` と入力する必要があったが、  
> **npx** コマンドを使えば実態ファイルの指定を省略して実行できる

<br>

#### Sassのローカルインストールとグローバルインストールでのコマンド使用例
```4D
// グローバルインストールしたパッケージの利用
$ sass --version

// ローカルインストールしたパッケージの利用
$ npx sass --version
```
**グローバルインストール**した場合は、システム全体で共通のバージョンとなるため、  
ディレクトリによってバージョンを変える必要があれば、**ローカルインストール**を利用する。  

<br>
<br>

## インストールしたパッケージを管理する
**npm** を使ってローカルインストールしたパッケージ情報は「**package.json**」ファイルで管理することが可能となる。  

「package.json」は、そのディレクトリ内で使用する複数のパッケージ情報（名称、バージョン番号など）  
を**JSON**形式でリスト管理できるファイルのこと。  

「package.json」を新規作成するには「**npm init**」コマンドを使用する。  
```rb
$ npm init -y
```
オプション「**-y**」をつけることで、package.json の**名称、作成者、ライセンスなどの初期設定**を  
コマンドライン上で設定していく行程を**省略できる**ので、必要に応じて設定する。  

<br>
<br>

package.json に、追加したパッケージ情報を追記するためには、  
パッケージインストール時にオプションの「**--save**」か「**--save-dev**」を使用する。  

「--save」は、**サイト上で使用するパッケージ**のインストール時に使用し、  
package.json の `dependencies` に追加される。  

「--save-dev」は、**Gulpなどの開発時のみに使用するパッケージ**のインストールに使用し、  
`devDependencies` に追加される。  

<br>
<br>

また、 `npm list` によって**パッケージのインストール先**の確認をすることもできる。  

#### ローカルインストールの場合
```4D
// ローカルインストールされたパッケージの確認
$ npm list --depth=0
```

#### グローバルインストールの場合
```4D
// グローバルインストール先の確認
$ npm list -g | head -1

// グローバルインストールされたパッケージの確認
$ npm list -g --depth=0
```

<br>
<br>

#### dependenciesにjQueryをインストールする
```4D
// --save
$ npm install jquery --save

// 省略形の「-S」でインストールする
$ npm install jquery -S
```
`dependencies` に jQuery とバージョン情報が追加される。  
```4D
{
  "name": "Test",

~~~~~~ 省略 ~~~~~~

  "dependencies": {
    "jquery": "^3.6.0"
  }
}
```

<br>

#### devDepenciesにGulpをインストールする
```4D
// --save-dev
$ npm install gulp --save-dev

//省略形の「-D」でインストールする
$ npm install gulp -D
```
`devDependencies` に Gulp とバージョン情報が追加される。  
```4D
{
  "name": "Test",

~~~~~~ 省略 ~~~~~~

  "devDependencies": {
    "gulp": "^4.0.2"
  }
}
```

<br>
<br>

**package.json** があるディレクトリで「**npm install**」を行うと、  
**個別のパッケージ名を入力しなくても、package.json に記載されているパッケージの一括インストールが可能**。
```rb
$ npm install
```
package.json を使用することで、複数人の開発においてもパッケージのバージョンを揃えることができるので、  
積極的に利用するようにする。  

